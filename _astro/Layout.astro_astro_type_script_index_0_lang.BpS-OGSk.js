const i={getElement(s){try{return document.getElementById(s)}catch(e){return console.warn(`无法获取元素: ${s}`,e),null}},debounce(s,e){let t;return function(...o){const a=()=>{clearTimeout(t),s(...o)};clearTimeout(t),t=setTimeout(a,e)}},storage:{get(s,e=null){try{return localStorage.getItem(s)||e}catch(t){return console.warn("localStorage读取失败:",t),e}},set(s,e){try{return localStorage.setItem(s,e),!0}catch(t){return console.warn("localStorage写入失败:",t),!1}}}};class c{currentTheme="light";isAnimating=!1;constructor(){this.init()}init(){try{const e=i.storage.get("theme","light");this.setTheme(e);const t=i.getElement("theme-toggle");t&&t.addEventListener("click",i.debounce(()=>this.toggleTheme(),300))}catch(e){console.error("主题管理器初始化失败:",e)}}setTheme(e){if(!["light","dark"].includes(e)){console.warn("无效的主题类型:",e);return}try{const t=document.documentElement,n=document.body,o=i.getElement("sun-icon"),a=i.getElement("moon-icon");requestAnimationFrame(()=>{e==="dark"?(t.classList.add("dark"),n.classList.add("dark"),o&&o.classList.add("hidden"),a&&a.classList.remove("hidden")):(t.classList.remove("dark"),n.classList.remove("dark"),o&&o.classList.remove("hidden"),a&&a.classList.add("hidden"))}),i.storage.set("theme",e),this.currentTheme=e}catch(t){console.error("设置主题失败:",t)}}toggleTheme(){if(this.isAnimating)return;this.isAnimating=!0;const e=this.currentTheme==="dark"?"light":"dark";this.setTheme(e);const t=i.getElement("theme-toggle");t?(t.style.transform="scale(0.95)",setTimeout(()=>{t.style.transform="scale(1)",this.isAnimating=!1},150)):this.isAnimating=!1}getCurrentTheme(){return this.currentTheme}}class l{constructor(){this.isOpen=!1,this.init()}init(){try{const e=i.getElement("mobile-menu-button"),t=i.getElement("mobile-menu");e&&t&&(e.addEventListener("click",n=>{n.stopPropagation(),this.toggleMenu(t)}),document.addEventListener("click",n=>{this.isOpen&&!e.contains(n.target)&&!t.contains(n.target)&&this.closeMenu(t)}),document.addEventListener("keydown",n=>{n.key==="Escape"&&this.isOpen&&this.closeMenu(t)}))}catch(e){console.error("移动端菜单初始化失败:",e)}}toggleMenu(e){this.isOpen?this.closeMenu(e):this.openMenu(e)}openMenu(e){e&&(e.classList.remove("hidden"),this.isOpen=!0,requestAnimationFrame(()=>{e.classList.add("animate-fade-in")}))}closeMenu(e){e&&(e.classList.add("hidden"),e.classList.remove("animate-fade-in"),this.isOpen=!1)}}class d{constructor(){this.isQuickNavOpen=!1,this.init()}init(){try{this.setupBackToTop(),this.setupQuickNavigation(),this.setupFloatingThemeToggle()}catch(e){console.error("浮动侧栏初始化失败:",e)}}setupBackToTop(){const e=i.getElement("back-to-top");if(!e)return;const t=i.debounce(()=>{(window.pageYOffset||document.documentElement.scrollTop)>300?(e.classList.remove("hidden"),e.classList.add("animate-fade-in")):(e.classList.add("hidden"),e.classList.remove("animate-fade-in"))},100);window.addEventListener("scroll",t),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}setupQuickNavigation(){const e=i.getElement("quick-nav-toggle"),t=i.getElement("quick-nav-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation(),this.toggleQuickNav(t)}),document.addEventListener("click",n=>{this.isQuickNavOpen&&!e.contains(n.target)&&!t.contains(n.target)&&this.closeQuickNav(t)}),document.addEventListener("keydown",n=>{n.key==="Escape"&&this.isQuickNavOpen&&this.closeQuickNav(t)}))}toggleQuickNav(e){this.isQuickNavOpen?this.closeQuickNav(e):this.openQuickNav(e)}openQuickNav(e){e.classList.remove("hidden"),this.isQuickNavOpen=!0,requestAnimationFrame(()=>{e.classList.add("animate-fade-in")})}closeQuickNav(e){e.classList.add("hidden"),e.classList.remove("animate-fade-in"),this.isQuickNavOpen=!1}setupFloatingThemeToggle(){const e=i.getElement("floating-theme-toggle");e&&(e.addEventListener("click",()=>{window.themeManager&&(window.themeManager.toggleTheme(),this.updateFloatingThemeIcons())}),this.updateFloatingThemeIcons())}updateFloatingThemeIcons(){const e=i.getElement("floating-sun-icon"),t=i.getElement("floating-moon-icon");if(!e||!t)return;(window.themeManager?.getCurrentTheme()||"light")==="dark"?(e.classList.add("hidden"),t.classList.remove("hidden")):(e.classList.remove("hidden"),t.classList.add("hidden"))}}class r{static init(){try{window.themeManager=new c,window.mobileMenuManager=new l,window.floatingSidebarManager=new d,this.setupSystemThemeListener()}catch(e){console.error("应用初始化失败:",e)}}static setupSystemThemeListener(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{i.storage.get("theme")||window.themeManager?.setTheme(t.matches?"dark":"light")})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r.init):r.init();
